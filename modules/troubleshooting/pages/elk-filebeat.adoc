1 = Set up Log Viewing with Elasticsearch, Kibana and Filebeat
2 :sectnums:
3 
4 The TigerGraph system produces extensive and detailed logs about each of
5 its components. Starting with TigerGraph 3.2, TigerGraph provides a
6 `+gadmin+` utility that allows users to easily view log files through an
7 Elasticsearch, Kibana, and Filebeat setup. This page offers a
8 step-by-step guide to set up log viewing for all components in a
9 TigerGraph cluster with Elastic search, Kibana, and Filebeat.
10 
11 == Before you begin
12 
13 * https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html[Install
14 Elasticsearch] on a machine that is running TigerGraph.
15 ** If you have a TigerGraph cluster, you only need to install
16 Elasticsearch on one node.
17 * https://www.elastic.co/guide/en/kibana/current/install.html[Install
18 Kibana] on the same machine where you installed Elasticsearch.
19 * https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation-configuration.html[Install
20 Filebeat].
21 ** If you have a TigerGraph cluster, you need to install Filebeat on all
22 nodes in the cluster.
23 
24 == Procedure
25 
26 [[configure-elasticsearch-for-remote-access]]
27 === Configure Elasticsearch for remote access
28 
29 The default Elasticsearch settings only allow the Elasticsearch service
30 to be accessed from the same machine it starts from. In order to allow
31 Elasticsearch to receive log files from other servers in the cluster, we
32 have to make the following edits to the file at
33 `+/etc/elasticsearch/elasticsearch.yml+`
34 
35 ....
36 network.host: "<server_private_ip>"
37 discovery.seed_hosts: ["<server_private_ip>"]
38 # server_private_ip refers to the private ip address of the machine where
39 # elasticsearch is installed
40 cluster.initial_master_nodes: [ "node-1" ]
41 # "node-1" is the default name of the Elasticsearch node. If you changed
42 # the default name, you would use the name you chose instead
43 ....
44 
45 After editing the configurations, restart the Elasticsearch service.
46 
47 Elasticsearch is a memory-intensive service. For more information on
48 memory management for Elasticsearch,
49 see https://www.elastic.co/blog/managing-and-troubleshooting-elasticsearch-memory[
50 Managing and Troubleshooting Elasticsearch Memory].
51 
52 [[configure-kibana-with-elasticsearch-and-enable-remote-access]]
53 === Configure Kibana with Elasticsearch and enable remote access
54 
55 You need to make the following changes to the file at
56 `+/etc/kibana/kibana.yml:+`
57 
58 * To allow remote access, change the value of `+server.host+` to the IP
59 address or DNS name of the Kibana server. Since the Kibana server is on
60 the same machine as Elasticsearch, this value should be the same private
61 IP that you specified as Elasticsearch's `+network.host+`.
62 * Additionally, you need to provide the address of the Elasticsearch
63 server in the `+elasticsearch.hosts+` setting. By default, Elasticsearch
64 is on port 9200, so the value for this setting should be
65 `+["server_private_ip:9200"]+`
66 
67 After editing the configurations, restart the Kibana service.
68 
69 [[configure-filebeat]]
70 == Configure Filebeat
71 
72 Finally, we need to configure Filebeat to have each component on each
73 node send its logs to the Elasticsearch server. To do so, run the
74 following gadmin command:
75 
76 ....
77 gadmin log build filebeat <--host={ip_address_1}[,{ip_address_n}]*>
78 ....
79 
80 The command outputs a Filebeat configuration file `+filebeat.yml+` . The
81 following options are available:
82 
83 [cols=",",options="header",]
84 |===
85 |Option |Description
86 |`+--host=<ip_list>+` |Required. The list of IP addresses of the nodes
87 whose logs you want to send to the Elasticsearch server. Example:
88 `+ --host=10.128.0.97,10.128.0.99,10.128.0.100+`
89 
90 |`+--from-beginning+` |Optional. If this flag is provided, Filebeat will
91 harvest all log files including the oldest. If not included, Filebeat
92 will only harvest the logs since the most recent time each service
93 started.
94 
95 |`+--path=<path_to_file>+` |Optional. The path to output the
96 configuration file. By default, the command outputs the configuration
97 file `+filebeat.yml+` to the current directory.
98 
99 |`+--service=<service_list>+` |Optional. The services you want Filebeat
100 to monitor. By default, all services are included. Example: --service=
101 |===
102 
103 After generating the `+filebeat.yml+` file, copy it to the directory
104 `+/etc/filebeat+` on every node, and restart the Filebeat service on
105 each node.
106 
107 After the service restarts, you should be able to view the logs through
108 Kibana's user interface in your browser at `+server_ip:5601+`.