1 = Log files
2 
3 TigerGraph Database captures key information on activities occurring across its different components through log functions that output to log files. These log files are not only helpful in xref:troubleshooting-guide.adoc[troubleshooting] but also serve as an auditory resource. This document gives a high-level overview of TigerGraph's logging structure and lists some common information one might need to monitor their database services and where to obtain them in the logs.
4 
5 == Overall Logging Structure
6 
7 Logs in TigerGraph are stored at `<tigergraph_root_dir>/log/`. TigerGraph's logs are divided into different folders by the different internal components and each folder corresponds to a different component. Log formats also vary across the different components. In folders where logs are checked often, such as `restpp`, `gsql`, and `admin`,  there are three symbolic links that help you quickly get to the most recent log file of that category:
8 
9 * `log.INFO`
10  ** Contains regular output and errors
11 * `log.ERROR`
12  ** Contains errors only
13 * `<component_name>.out`
14  ** Contains all output from the component process
15 * `log.WARNING` or `log.DEBUG`
16  ** `log.WARNING` contains warnings
17  ** In the``gsql`` folder, `log.DEBUG` contains very specific information you only need when certain errors happen
18 
19 Knowing where certain activities are recorded allows one to use tools such as the Linux `grep` command to easily obtain critical information from your database.
20 
21 == Monitor request history
22 
23 All requests made to TigerGraph's REST endpoints are recorded by the RESTPP logs and Nginx logs. Information available in the logs includes:
24 
25 * Timestamp of the request
26 * API request parameters
27 * Request Status
28 * User information (when RESTPP authentication is turned on)
29 
30 RESTPP is responsible for many tasks in the TigerGraph internal architecture and records many internal API calls, which can be hard to distinguish from manual requests. When xref:user-access:enabling-user-authentication.adoc#_enable_restpp_authentication[RESTPP authentication is on], the RESTPP log will record the user information and mark a call if it is made by an internal API. Therefore, you can use the command below to filter for manual requests:
31 
32 [source,bash]
33 ----
34 # In the restpp log directory
35 $ grep -i "requestinfo" log.INFO | grep -v "__INTERNAL_API__"
36 
37 # All requests exluding the ones made by internal API
38 I0315 21:11:59.666318 14535 handler.cpp:351] RequestInfo|,1.RESTPP_1_1.1615842719666.N,NNN,0,0,0|user:tigergraph|api:v2|function:NoSchema|graph_name:social|libudf:
39 I0315 21:41:36.462616 14541 handler.cpp:351] RequestInfo|,196622.RESTPP_1_1.1615844496462.N,NNN,0,0,0|user:tigergraph|api:v2|function:NoSchema|graph_name:social|libudf:
40 ----
41 
42 `RequestInfo` contains the ID of the request, which you can use to look up more information on the request :
43 
44 image::image%20%2875%29.png[Request ID]
45 
46 Here is an example of using a request ID to look up a request in the restpp log:
47 
48 [source,bash]
49 ----
50 $ grep "1615842719666" log.INFO
51 
52 # Returns all information about the specific request
53 # RawRequest log is captured at the entry point of a query
54 I0315 21:11:59.666026 14535 handler.cpp:285] RawRequest|,1.RESTPP_1_1.1615842719666.N,NNN,0,0,0|GET|/echo?parameter1=parameter_value|async = 0|payload_data.size() = 0|api = v2
55 # RequestInfo log is captured after the request has been parsed,
56 # and contains information such as username and the function or UDF to run
57 I0315 21:11:59.666318 14535 handler.cpp:351] RequestInfo|,1.RESTPP_1_1.1615842719666.N,NNN,0,0,0|user:tigergraph|api:v2|function:NoSchema|graph_name:social|libudf:
58 # ReturnResult is captured when the request has been processed
59 I0315 21:11:59.666509 14535 requestrecord.cpp:325] ReturnResult|0|0ms|RESTPP|1.RESTPP_1_1.1615842719666.N|user:tigergraph|/echo|graph_id=1&graph_name=social&parameter1=parameter_value|39
60 ----
61 
62 == Monitor user management tasks
63 
64 User management activities, such as logins, role and privilege changes are recorded in the GSQL logs in the folder `gsql`.
65 
66 To view recent activities, use the symlink `log.INFO`. There is a lot of information in the logs - to filter for information that you need, you can use Linux commands such as https://linuxcommand.org/lc3_man_pages/grep1.html[`grep`] and http://linuxcommand.org/lc3_man_pages/tail1.html[`tail`] For example, to view recent changes in roles, you can run the following command in the `gsql` log directory:
67 
68 [source,bash]
69 ----
70 $ grep -i "role" log.INFO
71 
72 # Returns all lines containing the word "role"
73 #                        username     source IP
74 I@20210312 22:41:16.167 tigergraph|127.0.0.1:45854|00000000077 (BaseHandler.java:133) Received|POST|/gsql/roles?action=grant&role=globaldesigner&name=lennessy|0
75 I@20210312 22:41:16.863 tigergraph|127.0.0.1:45854|00000000077 (BaseHandler.java:167) Successful|POST|/gsql/roles?action=grant&role=globaldesigner&name=lennessy|application/json; charset=UTF-8|696ms
76 ----
77 
78 To view login activities, search `log.INFO` for `"login"` instead.
79 
80 [source,bash]
81 ----
82 $ grep -i "login" log.INFO
83 
84 # Returns all lines containing the world "login"
85 I@20210315 21:08:42.047 tigergraph|127.0.0.1:53960|00000000001 (BaseHandler.java:133) Received|POST|/gsql/login|28
86 I@20210315 21:08:42.061 tigergraph|127.0.0.1:53960|00000000001 (LoginHandler.java:52) The gsql client is started on the server, and the working directory
87 is /home/tigergraph/tigergraph/log/restpp
88 I@20210315 21:08:42.072 tigergraph|127.0.0.1:53960|00000000001 (LoginHandler.java:80) Successful|Login|tigergraph
89 I@20210315 21:08:42.080 tigergraph|127.0.0.1:53960|00000000001 (BaseHandler.java:167) Successful|POST|/gsql/login|application/json; charset=UTF-8|35ms
90 ----
