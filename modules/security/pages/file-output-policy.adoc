1 = File Output Policy
2 
3 GSQL restricts where a query can produce output to files through a file output policy. The policy consists of a _whitelist_ and a _blacklist_.
4 
5 * GSQL queries must only output to the directories and their descendants or the files indicated by paths in the whitelist.
6 * GSQL queries _cannot_ output to the directories and their descendants or the files indicated by paths in the blacklist. The blacklist takes precedence over the whitelist.
7 
8 By default, the file output policy allows outputs to all files.
9 
10 == `GSQL.FileOutputPolicy`
11 
12 The file output policy is implemented through the system configuration parameter``GSQL.FileOutputPolicy``, which is a JSON array of strings that represents a list of paths. If there is an exclamation mark (`!`) preceding a path, the path is on the blacklist. If there is no exclamation mark preceding a path, the path is on the whitelist.
13 
14 === Example
15 
16 For example, if the value for `GSQL.FileOutputPolicy` is `["/home/tigergraph",  "!/home/tigergraph/documents", "!/home/tigergraph/desktop"]`, then below are the paths on the white list and on the black list:
17 
18 * Whitelist: `/home/tigergraph` and all its descendants
19 * Blacklist: `/home/tigergraph/documents, /home/tigergraph/desktop` and all their descendants.
20 
21 Since the blacklist takes precedence, GSQL will allow queries to write to all files and directories under `/home/tigergraph` except the `documents` and `destktop` folders.
22 
23 == Edit the file output policy
24 
25 . To edit the file policy, ensure that you are logged in as the TigerGraph Linux user, and run the following command:
26 +
27 [source,text]
28 ----
29 $ gadmin config entry GSQL.FileOutputPolicy
30 ----
31 
32 . In the prompt, enter the new value for the parameter:
33 +
34 [source,bash]
35 ----
36 GSQL.FileOutputPolicy [ ["/"] ]: The policy to control file outputs in GSQL queries
37 New: ["/home/tigergraph", "!/home/tigergraph/app"]
38 # Whitelist: /home/tigergraph and all its descendants
39 # Blacklist: /home/tigergraph/app and all its decendants
40 # Effect: GSQL can output to /home/tigergraph and all its decendants except /home/tigergraph/app
41 ----
42 
43 . Apply the new configurations and restart GSQL
44 +
45 [source,bash]
46 ----
47 $ gadmin config apply
48 $ gadmin restart gsql
49 ----
50 
51 After implementing the file output policy, queries that write to paths that are not on the whitelist are forbidden:
52 
53 [source,text]
54 ----
55 GSQL > BEGIN
56 GSQL > CREATE QUERY fileOutput() FOR GRAPH tpc_graph {
57 GSQL >   FILE f ("/home/documents/data.txt");
58 GSQL > }
59 GSQL > END
60 
61 Semantic Check Error in query fileOutput (SEM-2502): line 2, col 7
62 The path '/home/documents/data.txt' is not allowed by the file output policy.
63 For more info, please check log at node 'm2': /home/tigergraph/tigergraph/log/gsql/log.ERROR
64 Failed to create queries: [fileOutput].
65 ----
66 
67 NOTE: If a `FILE` object is defined with an empty string, GSQL regards it as a null file. The file output policy will not block the definition of the `FILE` object, but writing to a null file would cause a runtime error.
68 
69 Additionally, queries that write to paths on the whitelist, but also on the blacklist are also forbidden:
70 
71 [source,text]
72 ----
73 GSQL > BEGIN
74 GSQL > CREATE QUERY fileOutput() FOR GRAPH tpc_graph {
75 GSQL >   FILE f ("/home/tigergraph/app/data.txt");
76 GSQL > }
77 GSQL > END
78 
79 Semantic Check Error in query fileOutput (SEM-2502): line 3, col 7
80 The path '/home/tigergraph/app/data.txt' is not allowed by the file output
81 policy.
82 For more info, please check log at node 'm2': /home/tigergraph/tigergraph/log/gsql/log.ERROR
83 Failed to create queries: [fileOutput].
84 ----
